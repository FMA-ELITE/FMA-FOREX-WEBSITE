<!DOCTYPE html>
<html lang="en">
<!-- [HEAD SECTION REMAINS EXACTLY THE SAME AS YOUR ORIGINAL] -->

<body>
    <!-- [ALL YOUR EXISTING CONTENT REMAINS UNCHANGED UNTIL THE FIRST PAYMENT BUTTON] -->

    <!-- 1 MONTH PLAN (ORIGINAL STYLE WITH NEW PAYMENT SYSTEM) -->
    <div class="pricing-card">
        <h3 class="plan-name">1 Month</h3>
        <div class="price">50,000 UGX</div>
        <div class="installment">or 2 installments of 25,000 UGX</div> <!-- Added installment info -->
        <ul class="features">
            <li>3-5 signals per day (Mon-Fri)</li>
            <li>Basic WhatsApp support</li>
            <li>Entry/Exit/Target levels</li>
            <li>Daily market updates</li>
        </ul>
        
        <!-- New Payment Button Group -->
        <div class="payment-options">
            <button onclick="showPaymentOptions('1month')" class="btn">SUBSCRIBE NOW</button>
            
            <div id="1month-options" style="display:none; margin-top:10px;">
                <input type="tel" id="1month-phone" placeholder="256XXXXXXXXX" class="form-input">
                <button onclick="processPayment('1month', 50000)" class="btn" style="background:var(--green); margin-top:8px;">
                    Pay Full (50,000 UGX)
                </button>
                <button onclick="processPayment('1month', 25000)" class="btn" style="background:var(--purple); margin-top:8px;">
                    Pay Installment (25,000 UGX)
                </button>
                <p id="1month-status" class="status-message"></p>
            </div>
        </div>
    </div>

    <!-- [REPEAT THE SAME PATTERN FOR ALL OTHER PLANS] -->
    <!-- 3 MONTHS PLAN -->
    <div class="pricing-card">
        <div class="badge green">BEST VALUE</div>
        <h3 class="plan-name">3 Months</h3>
        <div class="price">110,000 UGX</div>
        <div class="installment">or 2 installments of 55,000 UGX</div> <!-- Added -->
        <!-- [...] -->
        <div class="payment-options">
            <button onclick="showPaymentOptions('3months')" class="btn">SUBSCRIBE NOW</button>
            <div id="3months-options" style="display:none; margin-top:10px;">
                <input type="tel" id="3months-phone" placeholder="256XXXXXXXXX" class="form-input">
                <button onclick="processPayment('3months', 110000)" class="btn" style="background:var(--green); margin-top:8px;">
                    Pay Full (110,000 UGX)
                </button>
                <button onclick="processPayment('3months', 55000)" class="btn" style="background:var(--purple); margin-top:8px;">
                    Pay Installment (55,000 UGX)
                </button>
                <p id="3months-status" class="status-message"></p>
            </div>
        </div>
    </div>

    <!-- [ALL OTHER HTML CONTENT REMAINS EXACTLY THE SAME] -->

    <!-- NEW JAVASCRIPT FOR PAYMENTS -->
    <script>
    // Toggle payment options
    function showPaymentOptions(planId) {
        document.getElementById(`${planId}-options`).style.display = 'block';
    }

    // Process payment via Africa's Talking
    async function processPayment(planId, amount) {
        const phone = document.getElementById(`${planId}-phone`).value;
        const statusElement = document.getElementById(`${planId}-status`);
        
        if (!phone || !phone.startsWith('256')) {
            statusElement.innerHTML = '<span style="color:red;">Enter valid UG phone (256XXXXXXXXX)</span>';
            return;
        }

        statusElement.innerHTML = '<span style="color:orange;">Processing payment...</span>';

        try {
            // Replace with your Render backend URL
            const response = await fetch('https://fma-payments.onrender.com/pay', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    product_name: `FMA_${planId}_${amount}`,
                    phone: phone,
                    amount: amount,
                    plan: planId
                })
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                statusElement.innerHTML = `
                    <span style="color:green;">âœ“ Payment initiated!</span><br>
                    <small>Complete the USSD prompt on your phone.</small>
                `;
            } else {
                throw new Error(result.message || 'Payment failed');
            }
        } catch (error) {
            statusElement.innerHTML = `<span style="color:red;">Error: ${error.message}</span>`;
        }
    }
    </script>
</body>
</html>