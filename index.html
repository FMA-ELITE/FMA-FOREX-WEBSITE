<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Keep all your existing head content -->
  <!-- Add this right before </head> -->
  <script>
    async function processPayment(planId, amount) {
      const phone = prompt("Enter your MTN/Airtel phone (256XXXXXXXXX):");
      if (!phone || !phone.startsWith('256')) {
        alert("Please enter a valid Uganda phone number starting with 256");
        return;
      }

      const statusElement = document.getElementById(`${planId}-status`);
      statusElement.innerHTML = '<span style="color:orange;">Processing payment...</span>';

      try {
        // Replace with your Render URL after deployment
        const response = await fetch('https://fma-payments.onrender.com/pay', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            plan: planId,
            amount: amount,
            phone: phone
          })
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
          statusElement.innerHTML = `
            <span style="color:green;">âœ“ Payment initiated!</span><br>
            <small>Complete the USSD prompt on your phone.<br>
            Transaction ID: ${result.transaction_id}</small>
          `;
        } else {
          throw new Error(result.message || 'Payment failed');
        }
      } catch (error) {
        statusElement.innerHTML = `<span style="color:red;">Error: ${error.message}</span>`;
      }
    }
  </script>
</head>
<body>
  <!-- Keep all your existing body content -->
  <!-- Replace ALL PesaPal buttons with this pattern: -->
  <div class="pricing-card">
    <h3 class="plan-name">1 Month</h3>
    <div class="price">50,000 UGX</div>
    <button onclick="processPayment('1month', 50000)" class="btn">PAY NOW</button>
    <p id="1month-status" class="status-message"></p>
  </div>
</body>
</html>